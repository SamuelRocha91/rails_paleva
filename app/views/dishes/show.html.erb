<div class='card p-3 shadow-sm'>
  <dl class="card-single card-new" style="width: 18rem;">
    <%= image_tag url_for(@dish.image), class: 'card-img-top' if @dish.image.attached? %>
    <div class="card-body">
      <div class='field-value'>
        <dt><%= Dish.human_attribute_name(:name) %>:</dt>
        <dd><%= @dish.name %></dd>
      </div>
      <div class='field-value'>
        <dt><%= Dish.human_attribute_name(:description) %>:</dt>
        <dd><%= @dish.description %></dd>
      </div>
      <div class='field-value'>
        <dt><%= Dish.human_attribute_name(:calories) %>:</dt>
        <dd><%= @dish.calories.present? ? @dish.calories : 'Não informada' %></dd>
      </div>
      <div class='field-value'>
        <dt><%= Dish.human_attribute_name(:status) %>:</dt>
        <dd><%= @dish.status ? 'Ativo' : 'Inativo' %></dd>
      </div>
      <div class='field-value'>
        <% if @dish.tags.any? %>
          <% @dish.tags.each do |tag| %>
            <dd>#<%= tag.name %> </dd>
          <% end %>
        <% end %>
      </div>
      <div>
        <% if @dish.portions.any? %>
          <h6>Porções Disponíveis:</h6>
          <% @dish.portions.each do |portion| %>
            <% if portion.active %>
              <div class='field-value'>
                <dt>Porção <%= portion.format.name %>:</dt>
                <dd> <%= number_to_currency(portion.price, unit: "R$", separator: ",", precision: 2) %></dd>
              </div>
              <%= link_to 'Editar Preço', edit_offer_dish_path(@dish.id, portion.id)  %>
              <%= button_to 'Retirar Oferta',deactivate_offer_dish_path(@dish.id, portion.id), class: "#{portion.format.name.gsub(' ', '-')} btn btn-danger" %>
            <% end %>
          <% end %>
        <% end %>
      </div>
      <div class="btn-group-double d-flex justify-content-around">
        <div class="btn-group-vertical w-50 px-2">
          <%= link_to 'Cadastrar porção', offer_dish_path(@dish.id), class: 'btn btn-light mb-2' %>
          <%= button_to 'Desativar Prato', deactivate_dish_path(@dish.id), class: 'btn btn-warning mb-2' if @dish.status %>
          <%= button_to 'Ativar Prato', activate_dish_path(@dish.id), class: 'btn btn-success mb-2' unless @dish.status %>
        </div>
        <div class="btn-group-vertical w-50 px-2">
          <%= link_to 'Editar prato', edit_establishment_dish_path(current_user.establishment.id, @dish.id), class: 'btn btn-light mb-2' %>
          <%= button_to 'Excluir prato', establishment_dish_path(current_user.establishment.id, @dish.id), 
                  data: { turbo_confirm: 'Tem certeza que deseja apagar o registro desse prato?' }, 
                  method: :delete, class: 'btn btn-danger mb-2' %>
        </div>
      </div>
    </div>
  </dl>
</div>

<table  class='table table-dark table-striped caption-top'>
  <caption class='title'>
    Histórico
  </caption>
  <thead>
    <tr>
      <th scope="col">Nome da porção</th>
      <th scope="col">Data de início</th>
      <th scope="col">Data de término</th>
      <th scope="col">Preço</th>
    </tr>
  </thead>
  <% if @dish.portions.any? %>
    <% @dish.portions.each do |portion| %>
      <% if !portion.active %>
        <tbody>
          <tr>
            <td><%= portion.format.name %></td>
            <td><%= portion.start_offer.strftime("%d-%m-%Y") %></td>
            <td><%= portion.end_offer.strftime("%d-%m-%Y") %></td>
            <td><%= number_to_currency(portion.price, unit: "R$", separator: ",", precision: 2) %></td>
          </tr>
        </tbody>
      <% end %>
    <% end %>
  <% end %>
</table>
